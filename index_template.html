<!DOCTYPE html>
<!--
   //////////////////////////////////////////////////////////////////////////
   //                                                                      //
   //    This file is automatically generated by the publish.py script.    //
   //    Any changes made manually will be overwritten during the next     //
   //    publish action.                                                   //
   //                                                                      //
   //////////////////////////////////////////////////////////////////////////
-->
<head>
   <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
   <meta http-equiv="Pragma" content="no-cache">
   <meta http-equiv="Expires" content="-1">
   <meta charset="utf-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>MusicBrainz Picard Documentation</title>
   <script>
      const supported_languages = {{supported_languages}};
      const default_language = '{{default_language}}';
      const current_version = '{{current_version}}';
      const queryString = window.location.search;
      const urlParams = new URLSearchParams(queryString);
      var language_code = "";
      var r_language = "";
      var r_version = "";
      var r_page = "";
      var r_anchor = "";
      function getLanguage() {
         let lg = {
            a: window.navigator.language,
            b: window.navigator.languages,
            c: window.navigator.userLanguage,
            d: window.navigator.browserLanguage,
            e: window.navigator.systemLanguage
            };
         let language =  {
            detected: lg.a || lg.c || lg.d || lg.e || lg.b[0],
            available: lg.b || [lg.a] || [lg.c] || [lg.d] || [lg.e]
         };
         if ( supported_languages.includes(language.detected) ) {
            return language.detected;
         }
         language_code = "";
         supported_languages.forEach(languageFull);
         if (language_code != "") {
            return language_code;
         };
         if (supported_languages.includes(language.detected.substring(0, 2))) {
            return language.detected.substring(0, 2);
         }
         supported_languages.forEach(languageSub);
         if (language_code != "") {
            return language_code;
         };
         return default_language;
      };

      function languageFull(item) {
         if ((language_code == "") && (supported_languages.includes(item))) {
            language_code = item;
         }
      };

      function languageSub(item) {
         if ((language_code == "") && (supported_languages.includes(item.substring(0, 2)))) {
            language_code = item.substring(0, 2);
         }
      };

      function makeURL() {
         var root_dir = '/';
         var r_target = "index.html";
         if (window.location.hostname.endsWith(".github.io")) {
            root_dir = '/picard-docs/';
         }
         if (urlParams.has('version')) { r_version = urlParams.get('version'); }
         if (urlParams.has('language')) { r_language = urlParams.get('language'); }
         if (urlParams.has('page')) { r_page = urlParams.get('page'); }
         if (urlParams.has('anchor')) { r_anchor = urlParams.get('anchor'); }
         if ((r_language == "") || (!supported_languages.includes(r_language))) { r_language = getLanguage(); }
         if (r_page != "") {
            r_target = r_page + ".html";
            if (r_anchor != "") { r_target = r_target + "#" + r_anchor; }
         }
         if (current_version == "") {
            if (r_version == "") {
               return root_dir + r_language + '/' + r_target;
            }
            return root_dir + r_version + '/index.html' + queryString;
         }
         else {
            return root_dir + current_version + '/' + r_language + '/' + r_target;
         }
      }
   </script>
</head>
<body onload="window.location.replace(makeURL());">
</body>
</html>
