<!DOCTYPE html>
<html class="writer-html5" lang="fr" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Écriture d’un Plugin &mdash; Documentation MusicBrainz Picard v2.8.2</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/extra.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/picard-icon.png"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/translations.js"></script>
        <script src="/version_links.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" />
    <link rel="next" title="Chargement des versions avec MusicBrainz pour Android" href="android_app.html" />
    <link rel="prev" title="Gestion de plusieurs pays de sortie" href="multiple_release_countries.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> MusicBrainz Picard
          </a>
              <div class="version">
                v2.8.2
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Rechercher docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">À propos de Picard</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../about_picard/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about_picard/contributing.html">Contribuer au projet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about_picard/acknowledgements.html">Remerciements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about_picard/glossary.html">Glossaire des termes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Commencer</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/download.html">Téléchargez et installez Picard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/screen_main.html">Écran principal</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/status_icons.html">Icônes d’état</a></li>
<li class="toctree-l1"><a class="reference internal" href="../config/configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../variables/variables.html">Balises &amp; Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extending/scripting.html">Script</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functions/list_by_type.html">Fonctions de script</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Utiliser Picard</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../usage/using.html">Usage général</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/other.html">Autres tâches de Picard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/option_profiles.html">Profils d’options</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extending/extending.html">Prolonger Picard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/faq.html">Questions fréquemment posées</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Recommandations générales</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../workflows/workflows.html">Recommandations générales</a></li>
<li class="toctree-l1"><a class="reference internal" href="../workflows/workflow_cd.html">Lorsque le CD est disponible</a></li>
<li class="toctree-l1"><a class="reference internal" href="../workflows/workflow_extractor_log.html">Lorsque le fichier journal du ripper est disponible</a></li>
<li class="toctree-l1"><a class="reference internal" href="../workflows/workflow_album.html">Lorsque les fichiers sont regroupés par album</a></li>
<li class="toctree-l1"><a class="reference internal" href="../workflows/workflow_metadata.html">Lorsque les fichiers ne sont pas groupés mais ont des métadonnées</a></li>
<li class="toctree-l1"><a class="reference internal" href="../workflows/workflow_no_info.html">Lorsque les fichiers ne sont pas regroupés et ont peu ou pas de métadonnées existantes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Dépannage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting/troubleshooting.html">Dépannage général</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting/does_not_start.html">Picard ne démarre pas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting/no_coverart.html">Il n’y a pas de pochette</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting/missing_tags.html">Les balises ne sont pas mises à jour ou enregistrées</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting/not_saving.html">Les fichiers ne sont pas enregistrés</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting/stopped_working.html">Picard vient de cesser de travailler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting/macos_startup_error.html">macOS montre que l’application est endommagée</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutoriels</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="naming_script.html">Ecriture d’un script de nommage de fichier</a></li>
<li class="toctree-l1"><a class="reference internal" href="acoustid.html">Comprendre Empreintes acoustiques et AcoustIDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="multiple_release_countries.html">Gestion de plusieurs pays de sortie</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Écriture d’un Plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="android_app.html">Chargement des versions avec MusicBrainz pour Android</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Annexes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../appendices/plugins_api.html">Annexe A: API des plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendices/tag_mapping.html">Annexe B: Mappage de balises</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendices/command_line.html">Annexe C : Options de ligne de commande</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendices/keyboard_shortcuts.html">Annexe D : Courts clavier</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functions/list_by_name.html">Annexe E : Fonctions de script classées par ordre alphabétique</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Références</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../genindex.html">Index</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MusicBrainz Picard</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Écriture d’un Plugin</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="writing-a-plugin">
<h1>Écriture d’un <span class="target" id="index-1"></span>Plugin<a class="headerlink" href="#writing-a-plugin" title="Lien permanent vers ce titre"></a></h1>
<p>Vous avez une excellente idée pour étendre Picard avec un plugin mais vous ne savez pas par où commencer.  Malheureusement, c’est un problème courant qui empêche beaucoup trop de ces grandes idées de voir le jour.  Peut-être que ce tutoriel vous aidera à commencer à transformer votre grande idée en réalité.</p>
<p>Les plugins Picard sont écrits en Python, c’est donc le langage de programmation que vous utiliserez.  Veuillez vérifier le fichier <a class="reference external" href="https://github.com/metabrainz/picard/blob/master/INSTALL.md">INSTALL.md</a> dans le dépôt Picard sur GitHub pour voir la version minimale requise. Il s’agit de Python 3.6 au moment où ce tutoriel a été écrit.  Consultez également la <a class="reference internal" href="../appendices/plugins_api.html"><span class="doc">Plugins API</span></a> pour obtenir des informations supplémentaires, notamment les paramètres passés à chacun des types de fonctions.</p>
<p>Pour les besoins de ce tutoriel, nous allons développer un plugin simple pour sauvegarder les informations sur les arguments fournis par Picard aux plugins de traitement <code class="docutils literal notranslate"><span class="pre">track</span></code> et <code class="docutils literal notranslate"><span class="pre">release</span></code>.  Cela démontrera comment on accède à ces informations, et fournira un utilitaire que vous pourrez trouver utile lorsque vous développerez vos propres plugins.</p>
<p>La première chose que nous devons inclure est l’information d’en-tête qui décrit le plugin.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">PLUGIN_NAME</span> <span class="o">=</span> <span class="s2">&quot;Example plugin&quot;</span>
<span class="n">PLUGIN_AUTHOR</span> <span class="o">=</span> <span class="s2">&quot;This authors name&quot;</span>
<span class="n">PLUGIN_DESCRIPTION</span> <span class="o">=</span> <span class="s2">&quot;This plugin is an example&quot;</span>
<span class="n">PLUGIN_VERSION</span> <span class="o">=</span> <span class="s1">&#39;0.1&#39;</span>
<span class="n">PLUGIN_API_VERSIONS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;2.2&#39;</span><span class="p">]</span>
<span class="n">PLUGIN_LICENSE</span> <span class="o">=</span> <span class="s2">&quot;GPL-2.0-or-later&quot;</span>
<span class="n">PLUGIN_LICENSE_URL</span> <span class="o">=</span> <span class="s2">&quot;https://www.gnu.org/licenses/gpl-2.0.html&quot;</span>
</pre></div>
</div>
<p>Ensuite, nous listons les modules qui seront référencés dans notre code.  Dans ce cas, nous utiliserons le module <code class="docutils literal notranslate"><span class="pre">os</span></code> pour construire le chemin du fichier de sortie, et le module <code class="docutils literal notranslate"><span class="pre">json</span></code> pour formater le texte du dictionnaire d’arguments pour une meilleure lisibilité. Nous enregistrerons notre fichier de sortie dans le répertoire de base utilisé pour le nommage des fichiers. Nous importons donc le module <code class="docutils literal notranslate"><span class="pre">config</span></code> de Picard, ainsi que le module <code class="docutils literal notranslate"><span class="pre">log</span></code> pour pouvoir écrire des messages de débogage ou d’erreur dans le journal de Picard.  Enfin, nous importons les hooks de traitement appropriés et les paramètres de priorité des plugins.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">picard</span> <span class="kn">import</span> <span class="n">config</span><span class="p">,</span> <span class="n">log</span>
<span class="kn">from</span> <span class="nn">picard.metadata</span> <span class="kn">import</span> <span class="p">(</span><span class="n">register_album_metadata_processor</span><span class="p">,</span>
                           <span class="n">register_track_metadata_processor</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">picard.plugin</span> <span class="kn">import</span> <span class="n">PluginPriority</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Avertissement</p>
<p>Pour assurer une compatibilité maximale, vous ne devez utiliser que des modules Python standard, ou des modules tiers qui sont déjà inclus dans Picard.  Si vous utilisez d’autres modules, alors le plugin ne fonctionnera pas correctement s’il est utilisé sur un système qui n’a pas la bonne version du module installé ou si quelqu’un utilise une version exécutable de Picard.</p>
</div>
<p>Maintenant nous pouvons commencer à ajouter le code que nous voulons que Picard exécute. Tout d’abord, nous allons identifier le fichier de sortie pour stocker les informations sur les paramètres fournis par Picard. Il s’agit d’un fichier nommé <code class="docutils literal notranslate"><span class="pre">data_dump.txt</span></code> qui sera stocké dans le répertoire de sortie du nommage des fichiers. Nous trouvons le nom du paramètre de configuration dont nous avons besoin, <code class="docutils literal notranslate"><span class="pre">move_files_to</span></code>, en examinant le code source de Picard pour l’écran de paramétrage des options correspondant. Dans ce cas, il s’agit d’une TextOption dans la classe <code class="docutils literal notranslate"><span class="pre">RenamingOptionsPage</span></code> trouvée dans le fichier <a class="reference external" href="https://github.com/metabrainz/picard/blob/master/picard/ui/options/renaming.py">picard/ui/options/renaming.py</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">file_to_write</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">setting</span><span class="p">[</span><span class="s2">&quot;move_files_to&quot;</span><span class="p">],</span> <span class="s2">&quot;data_dump.txt&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>La partie suivante est une fonction permettant d’écrire un objet Python dans notre fichier de sortie.  Pour permettre à la même fonction d’être utilisée dans différentes situations, nous incluons des paramètres pour identifier le type de ligne (type d’entrée), l’objet à écrire, et des options pour écrire au format JSON et ajouter ou écraser un fichier de sortie existant. Dans notre cas, nous voulons écraser le fichier à chaque fois qu’une nouvelle version est traitée, mais toujours ajouter les informations sur les pistes au fichier.</p>
<p>Nous avons également inclus un contrôle d’erreur pour écrire une entrée dans le journal Picard en cas d’exception.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">write_line</span><span class="p">(</span><span class="n">line_type</span><span class="p">,</span> <span class="n">object_to_write</span><span class="p">,</span> <span class="n">dump_json</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">file_mode</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span> <span class="k">if</span> <span class="n">append</span> <span class="k">else</span> <span class="s1">&#39;w&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_to_write</span><span class="p">,</span> <span class="n">file_mode</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dump_json</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> JSON dump follows:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line_type</span><span class="p">,))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">object_to_write</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}</span><span class="s2">: </span><span class="si">{1:s}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line_type</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">object_to_write</span><span class="p">),))</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">: Error: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">PLUGIN_NAME</span><span class="p">,</span> <span class="n">ex</span><span class="p">,))</span>
</pre></div>
</div>
<p>Maintenant, nous incluons les fonctions qui seront appelées lorsque les releases et les tracks seront récupérés par Picard. Le hook de la fonction release fournit trois arguments, et le hook de la fonction track fournit quatre arguments. Les types d’arguments sont décrits dans la section <a class="reference internal" href="../appendices/plugins_api.html"><span class="doc">Plugins API</span></a>. Le premier argument, <code class="docutils literal notranslate"><span class="pre">album</span></code>, est un objet qui contient des informations sur l’album sélectionné. Voir la classe <code class="docutils literal notranslate"><span class="pre">Album</span></code> dans le fichier <a class="reference external" href="https://github.com/metabrainz/picard/blob/master/picard/album.py">picard/album.py</a> du code source de Picard pour plus d’informations.</p>
<p>Le second argument, <code class="docutils literal notranslate"><span class="pre">metadata</span></code>, est un objet qui contient les tags et les variables que Picard a assignés pour la version et la piste en cours. C’est ici que vous pouvez ajouter ou modifier les tags et les variables que Picard met à disposition de l’utilisateur pour les scripts. Voir la classe <code class="docutils literal notranslate"><span class="pre">Metadata</span></code> dans le fichier <a class="reference external" href="https://github.com/metabrainz/picard/blob/master/picard/metadata.py">picard/metadata.py</a> du code source de Picard pour plus d’informations.</p>
<p>Les arguments <code class="docutils literal notranslate"><span class="pre">track</span></code> et <code class="docutils literal notranslate"><span class="pre">release</span></code> sont des dictionnaires Python contenant les informations fournies en réponse aux appels de Picard à l’API MusicBrainz. Les informations peuvent différer selon les paramètres <a class="reference internal" href="../config/options_metadata.html"><span class="doc">Options de métadonnées</span></a> de l’utilisateur pour des choses comme « <em>Utiliser les relations de validation</em> » ou « <em>Utiliser les relations de suivi</em> ».</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">dump_release_info</span><span class="p">(</span><span class="n">album</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">release</span><span class="p">):</span>
    <span class="n">write_line</span><span class="p">(</span><span class="s1">&#39;Release Argument 1 (album)&#39;</span><span class="p">,</span> <span class="n">album</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">write_line</span><span class="p">(</span><span class="s1">&#39;Release Argument 3 (release)&#39;</span><span class="p">,</span> <span class="n">release</span><span class="p">,</span> <span class="n">dump_json</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">dump_track_info</span><span class="p">(</span><span class="n">album</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="n">release</span><span class="p">):</span>
    <span class="n">write_line</span><span class="p">(</span><span class="s1">&#39;Track Argument 1 (album)&#39;</span><span class="p">,</span> <span class="n">album</span><span class="p">)</span>
    <span class="n">write_line</span><span class="p">(</span><span class="s1">&#39;Track Argument 3 (track)&#39;</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="n">dump_json</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># write_line(&#39;Track Argument 4 (release)&#39;, release, dump_json=True)</span>
</pre></div>
</div>
<p>Enfin, nous devons enregistrer nos fonctions afin qu’elles soient traitées avec les événements appropriés.  Dans notre cas, nous mettons la priorité à « HIGH » pour que nous puissions sortir les informations des paramètres dès qu’elles sont reçues par Picard avant que d’autres plugins aient l’opportunité de les modifier.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Register the plugin to run at a HIGH priority so that other plugins will</span>
<span class="c1"># not have an opportunity to modify the contents of the metadata provided.</span>
<span class="n">register_album_metadata_processor</span><span class="p">(</span><span class="n">dump_release_info</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="n">PluginPriority</span><span class="o">.</span><span class="n">HIGH</span><span class="p">)</span>
<span class="n">register_track_metadata_processor</span><span class="p">(</span><span class="n">dump_track_info</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="n">PluginPriority</span><span class="o">.</span><span class="n">HIGH</span><span class="p">)</span>
</pre></div>
</div>
<p>Le fichier de code complet du plugin ressemble à quelque chose comme:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">PLUGIN_NAME</span> <span class="o">=</span> <span class="s2">&quot;Example plugin&quot;</span>
<span class="n">PLUGIN_AUTHOR</span> <span class="o">=</span> <span class="s2">&quot;This authors name&quot;</span>
<span class="n">PLUGIN_DESCRIPTION</span> <span class="o">=</span> <span class="s2">&quot;This plugin is an example&quot;</span>
<span class="n">PLUGIN_VERSION</span> <span class="o">=</span> <span class="s1">&#39;0.1&#39;</span>
<span class="n">PLUGIN_API_VERSIONS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;2.2&#39;</span><span class="p">]</span>
<span class="n">PLUGIN_LICENSE</span> <span class="o">=</span> <span class="s2">&quot;GPL-2.0-or-later&quot;</span>
<span class="n">PLUGIN_LICENSE_URL</span> <span class="o">=</span> <span class="s2">&quot;https://www.gnu.org/licenses/gpl-2.0.html&quot;</span>

<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">picard</span> <span class="kn">import</span> <span class="n">config</span><span class="p">,</span> <span class="n">log</span>
<span class="kn">from</span> <span class="nn">picard.metadata</span> <span class="kn">import</span> <span class="p">(</span><span class="n">register_album_metadata_processor</span><span class="p">,</span>
                           <span class="n">register_track_metadata_processor</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">picard.plugin</span> <span class="kn">import</span> <span class="n">PluginPriority</span>

<span class="n">file_to_write</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">setting</span><span class="p">[</span><span class="s2">&quot;move_files_to&quot;</span><span class="p">],</span> <span class="s2">&quot;data_dump.txt&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">write_line</span><span class="p">(</span><span class="n">line_type</span><span class="p">,</span> <span class="n">object_to_write</span><span class="p">,</span> <span class="n">dump_json</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">file_mode</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span> <span class="k">if</span> <span class="n">append</span> <span class="k">else</span> <span class="s1">&#39;w&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_to_write</span><span class="p">,</span> <span class="n">file_mode</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dump_json</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> JSON dump follows:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line_type</span><span class="p">,))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">object_to_write</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}</span><span class="s2">: </span><span class="si">{1:s}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line_type</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">object_to_write</span><span class="p">),))</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">: Error: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">PLUGIN_NAME</span><span class="p">,</span> <span class="n">ex</span><span class="p">,))</span>

<span class="k">def</span> <span class="nf">dump_release_info</span><span class="p">(</span><span class="n">album</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">release</span><span class="p">):</span>
    <span class="n">write_line</span><span class="p">(</span><span class="s1">&#39;Release Argument 1 (album)&#39;</span><span class="p">,</span> <span class="n">album</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">write_line</span><span class="p">(</span><span class="s1">&#39;Release Argument 3 (release)&#39;</span><span class="p">,</span> <span class="n">release</span><span class="p">,</span> <span class="n">dump_json</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">dump_track_info</span><span class="p">(</span><span class="n">album</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="n">release</span><span class="p">):</span>
   <span class="n">write_line</span><span class="p">(</span><span class="s1">&#39;Track Argument 1 (album)&#39;</span><span class="p">,</span> <span class="n">album</span><span class="p">)</span>
   <span class="n">write_line</span><span class="p">(</span><span class="s1">&#39;Track Argument 3 (track)&#39;</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="n">dump_json</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
   <span class="c1"># write_line(&#39;Track Argument 4 (release)&#39;, release, dump_json=True)</span>

<span class="c1"># Register the plugin to run at a HIGH priority so that other plugins will</span>
<span class="c1"># not have an opportunity to modify the contents of the metadata provided.</span>
<span class="n">register_album_metadata_processor</span><span class="p">(</span><span class="n">dump_release_info</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="n">PluginPriority</span><span class="o">.</span><span class="n">HIGH</span><span class="p">)</span>
<span class="n">register_track_metadata_processor</span><span class="p">(</span><span class="n">dump_track_info</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="n">PluginPriority</span><span class="o">.</span><span class="n">HIGH</span><span class="p">)</span>
</pre></div>
</div>
<p>C’est tout pour le code de notre plugin. Maintenant nous devons l’empaqueter afin de pouvoir l’installer dans Picard.  Si nous voulons juste l’utiliser localement pour nous-mêmes, le plus simple est de nommer le fichier comme <code class="file docutils literal notranslate"><span class="pre">my_plugin.py</span></code>.  S’il y a plusieurs fichiers, comme des plugins qui incluent des écrans de réglages supplémentaires, alors les fichiers doivent être enregistrés dans un répertoire tel que <code class="file docutils literal notranslate"><span class="pre">my_plugin</span></code> avec le fichier principal nommé <code class="file docutils literal notranslate"><span class="pre">__init__.py</span></code>.  Le répertoire est ensuite archivé dans un fichier <code class="file docutils literal notranslate"><span class="pre">my_plugin.zip</span></code>, dont le nom de fichier est identique au nom du répertoire inclus. Le contenu de l’archive s’afficherait comme suit:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my_plugin</span><span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
<span class="n">my_plugin</span><span class="o">/</span><span class="n">another_file</span><span class="o">.</span><span class="n">py</span>
<span class="n">my_plugin</span><span class="o">/</span><span class="n">etc</span>
</pre></div>
</div>
<p>Si vous êtes arrivé jusqu’ici, félicitations ! Vous venez de créer votre premier plugin Picard. Vous avez maintenant un point de départ pour transformer cette grande idée en réalité.</p>
<div class="admonition seealso">
<p class="admonition-title">Voir aussi</p>
<p>Des portions pertinentes du code source de Picard, y compris:</p>
<ul class="simple">
<li><p>Modules de paramétrage des options dans <a class="reference external" href="https://github.com/metabrainz/picard/tree/master/picard/ui/options">picard/ui/options/</a> pour les noms utilisés pour accéder aux paramètres.</p></li>
<li><p>La classe <code class="docutils literal notranslate"><span class="pre">Album</span></code> dans le fichier <a class="reference external" href="https://github.com/metabrainz/picard/blob/master/picard/album.py">picard/album.py</a>.</p></li>
<li><p>La classe <code class="docutils literal notranslate"><span class="pre">Metadata</span></code> et les fonctions d’enregistrement du plugin de traitement des métadonnées dans le fichier <a class="reference external" href="https://github.com/metabrainz/picard/blob/master/picard/metadata.py">picard/metadata.py</a>.</p></li>
<li><p>La classe <code class="docutils literal notranslate"><span class="pre">PluginPriority</span></code> dans le fichier <a class="reference external" href="https://github.com/metabrainz/picard/blob/master/picard/plugin.py">picard/plugin.py</a>.</p></li>
</ul>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="android_app.html" class="btn btn-neutral float-right" title="Chargement des versions avec MusicBrainz pour Android" accesskey="n" rel="next">Page suivante <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="multiple_release_countries.html" class="btn btn-neutral float-left" title="Gestion de plusieurs pays de sortie" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Page précédente</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p xmlns:dct="http://purl.org/dc/terms/" xmlns:cc="http://creativecommons.org/ns#" class="license-text">Ce guide de l'utilisateur MusicBrainz Picard est sous licence CC0 1.0 <a href="https://creativecommons.org/publicdomain/zero/1.0"><img  style="height:22px!important;margin-left: 3px;vertical-align:text-bottom;" src="/cc-zero.png" /></a></p>
    <!-- <p>
        
        &copy; Droits d'auteur This documentation is licensed under CC0 1.0.

    </p> -->
  </div>
    
    
      Construit avec <a href="http://sphinx-doc.org/">Sphinx</a> en utilisant un <a href="https://github.com/rtfd/sphinx_rtd_theme">thème</a> fourni par <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>
    </section>
  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Options</span>
      fr
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl id="select_version">
        <dt>Sélectionner la version</dt>
      </dl>
      <script>list_versions('fr', 'tutorials/write_plugin', 'stable',  'dernière');</script>
      <dl>
        <dt>Choisir la langue</dt>
        
        
        <dd><a href="../../en/tutorials/write_plugin.html" class="__ptNoRemap">English</a></dd>
        
        <dd><a href="../../fr/tutorials/write_plugin.html" class="__ptNoRemap">Français</a></dd>
        
        
      </dl>

      <dl>
        <dt>Téléchargements</dt>
        <dd><a href="/downloads/MusicBrainz_Picard_v2.8_[fr].pdf" target="_blank" class="__ptNoRemap">Fichier PDF</a></dd>
        <dd><a href="/downloads/MusicBrainz_Picard_v2.8_[fr].epub" target="_blank" class="__ptNoRemap">Fichier epub</a></dd>
        <dd><a href="/downloads/MusicBrainz_Picard_v2.8_HTML_[fr].zip" target="_blank" class="__ptNoRemap">Fichiers HTML</a></dd>
        <dd><a href="/downloads/MusicBrainz_Picard_Tag_Map.xlsx" target="_blank" class="__ptNoRemap">Feuille de calcul carte des étiquettes</a></dd>
      </dl>

    </div>
  </div>
<script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>